

To render the navigation tree as a nested list, the Starter Kit provides the CAE views submenuChildren (implemented for CMNavigation) and submenuItem (implemented for CMNavigation and CMLinkable).

The essential part of CMNavigation.submenuChildren.jsp is:

<c:if test="${not empty self.visibleChildren}">
  <ul>
   <c:forEach items="${self.visibleChildren}" var="child">
    <cm:include self="${child}" view="submenuItem"/>
   </c:forEach>
  </ul>
 </pbe:contextinfo>
</c:if>

The template simply tests whether there are any children at all, and if so, renders a ul element and iterates over all visible children (i.e. all child navigation nodes that do not have the hidden flag set). For each child, the view submenuItem is included. This is where the CAE's polymorphic view dispatch comes in: the view is implemented differently for navigation sub-nodes (CMNavigation) and other sub-nodes (CMLinkable).

Here is a simplified version of CMNavigation.submenuItem.jsp:

<li>
  <a href='<cm:link target="${self}"/>'>${self.linktext}</a>
  <cm:include self="${self}" view="submenuChildren"/>
</li>

The template renders a li element containing an hyperlink to the current navigation channel's page and includes its submenuChildren view. This means that for nested navigation channels, the two views include each other recursively.

It may not always be desired to expand all sub-nodes. To only expand the sub-nodes of nodes lying on the path to the current page, you can access the request scope Bean cmpage, which contains the page of the current request, and use the custom Starter Kit JSP function navigationBelowOrEquals (also see Tag-Lib-Reference):

<jsp:useBean id="cmpage" scope="request"
  type="com.coremedia.starterkit.common.contentbeans.Page"/>
<li>
  <a href='<cm:link target="${self}"/>'>${self.linktext}</a>
  <c:if test="${sk:navigationBelowOrEquals(cmpage.navigation,self)}">
    <cm:include self="${self}" view="submenuChildren"/>
  </c:if>
</li>

The template CMLinkable.submenuItem.jsp does not add any new aspects, it just leaves out including the submenuChildren view completely.
