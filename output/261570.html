<div xmlns="http://www.coremedia.com/2003/richtext-1.0" xmlns:xlink="http://www.w3.org/1999/xlink"><p class="p--heading-2">Session Management</p><p>The session manager and user sessions are the main elements of Social Software session management.</p><p><strong>Session Manager</strong></p><p>The session manager (interface <span class="inlineformat--code">com.coremedia.sse.base.session.SessionManager</span>), available in the application context as bean "sessionManager", is responsible for creating user sessions. It provides information on </p><ul><li>the number of users online (<span class="inlineformat--code">#getNumberOfOnlineUsers</span>) and provides online users queries,</li><li>the number of open sessions (<span class="inlineformat--code">#getNumberOfOpenSessions</span>) and provides open session queries,</li><li>and information on the sessions of a given user.</li></ul><p>In order to create a new user session, use the Session Manager method <span class="inlineformat--code">#createSession </span>(see the authentication example in the previous section).</p><p>User Session</p><p>The user session (interface <span class="inlineformat--code">com.coremedia.sse.base.session.UserSession</span>) represents a session a logged-in user has with the Social Software system. It holds a reference to the <em>User</em> resource.</p><p><strong>Session Creation</strong></p><p>The Session Manager is responsible for creating new sessions (see above).</p><p><strong>Session Termination</strong></p><p>User sessions can be terminated / closed by calling <span class="inlineformat--code">#close</span> on them. Note that this does <strong>not </strong>close or invalidate any HttpSession.</p><p>Cascading Session Termination: Usually, it is required that user sessions are closed when the associate HttpSession is closed or invalidated. Two options are available in order to achieve this.</p><ul><li>If you are using Spring MVC and if you are using <span class="inlineformat--code">RequestAttributes#setAttribute</span> and <span class="inlineformat--code">#getAttribute </span>to store and retrieve User Sessions as a request or session scope attribute value, then register a <span class="inlineformat--code">com.coremedia.sse.base.session.UserSessionDestructionCallback</span>. The wrapped user session will be closed when the scope is destroyed (the request is completed or the session terminates, respectively). </li></ul><p>Example:</p><p class="p--codeblock">RequestAttributes attributes = new ServletRequestAttributes(request);<br/>  attributes.setAttribute(<br/>  sessionAttributeName,<br/>  userSession, RequestAttributes.SCOPE_GLOBAL_SESSION);<br/><br/>attributes.registerDestructionCallback(<br/>  sessionAttributeName,<br/>  new UserSessionDestructionCallback(userSession),<br/>  RequestAttributes.SCOPE_GLOBAL_SESSION);</p><ul><li>If you are not using Spring MVC, you may use the simple Servlet API fallback. When storing the User Session in the Http Session via calling <span class="inlineformat--code">#setAttribute</span> (which typically happens just once per session), you must first decorate / wrap the plain <span class="inlineformat--code">UserSession</span> in a <span class="inlineformat--code">com.coremedia.sse.base.session.UserSessionBindingListenerDecorator</span> (which implements the <span class="inlineformat--code">UserSession </span>interface). The decorator implements the <span class="inlineformat--code">HttpSessionBindingListener</span> interface and will automatically close the User Session when the attribute is manually unbound from the HttpSession or the HttpSession is closed. Note that this is ONLY an option when you are NOT using the above mentioned Spring MVC and scoped attributes.</li></ul><p><strong>Request-local access to the current user session</strong></p><p>Most applications require access to the active user session while servicing an HTTP request. For this common purpose, the <em>SSE</em> default configuration provides the user session context. It is available in the application context as a bean with name "userSessionContext" and implements the <span class="inlineformat--code">com.coremedia.sse.base.session.UserSessionContext</span> interface. The implementation class configured by default is <span class="inlineformat--code">com.coremedia.sse.web.ServletUserSessionContext</span>, which should be appropriate for many applications. The following descriptions assumes the use of this implementation, although you may replace the bean with your own implementation.</p><ul><li>inject the <span class="inlineformat--code">ServletUserSessionContext</span> ("userSessionContext") bean into your login controller (which creates the user session), and store the user session reference in the <span class="inlineformat--code">HttpSession</span> by calling <span class="inlineformat--code">ServletUserSessionContext#storeInHttpSession</span></li><li>add the <span class="inlineformat--code">com.coremedia.sse.web.ServletUserSessionContextInterceptor</span> to your handler chain in order to make the user session available to the <span class="inlineformat--code">ServletUserSessionContext</span> while the request is being handled</li><li>during request handler execution, the current user session will now be available via <span class="inlineformat--code">UserSessionContext#getUserSession</span> (inject the "userSessionContext" bean where access to the session is required)</li><li>inject the <span class="inlineformat--code">ServletUserSessionContext</span> ("userSessionContext") bean into your logout controller (which calls <span class="inlineformat--code">UserSession#close</span>), and remove the user session reference from the <span class="inlineformat--code">HttpSession</span> by calling <span class="inlineformat--code">ServletUserSessionContext#removeFromHttpSession</span></li></ul><p>If the "userSessionContext" bean is setup correctly, the current user information will be added to the change log entry whenever a change is made to a <em>SSE</em> element while the request is being handled. This information is currently not accessible via the <em>SSE API</em>.</p></div>