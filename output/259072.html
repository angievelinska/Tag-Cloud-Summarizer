<div xmlns="http://www.coremedia.com/2003/richtext-1.0" xmlns:xlink="http://www.w3.org/1999/xlink"><p class="p--heading-1">Using Criteria</p><p><span class="inlineformat--code">Criterion</span> is an object-oriented representation for some condition which must be satisfied for an item if it should be included into the query result. <span class="inlineformat--code">Criterion</span> objects are, as well as <span class="inlineformat--code">Projection</span> and <span class="inlineformat--code">Order</span> instances, created using criteria factories. </p><p>The base module provides several criteria factories. Each one is designed for a specific domain model type. For example, there is a criteria factory designed for <span class="inlineformat--code">UserContent</span> which is called <span class="inlineformat--code">UserContentCriteria</span>. </p><p>The following example query retrieves users with the name <span class="inlineformat--code">"Alice"</span>.  Note that most query methods return the query object itself, so we can simply chain together our method calls: </p><p class="p--codeblock">List&lt;User&gt; users = (List&lt;User&gt;)  <br/>  baseModule.createQuery(baseModule.getUserType())<br/>   .where(baseModule.getUserCriteria().nameIs("Alice"))<br/>   .list();</p><p>This query is yielding resource beans of type <span class="inlineformat--code">User</span>. The result set is restricted by a criterion requiring the user objects to have a property with the value <span class="inlineformat--code">"Alice"</span>.  The citerion factory method <span class="inlineformat--code">UserCriteria.nameIs(String value)</span> is implemented by using the generic method <span class="inlineformat--code">ElementCriteria.propertyIs(String propertyName, Object value)</span><span xml:lang="EN-US">. It is provided just for programming convenience, you could as well use the generic method.</span></p><p><span xml:lang="EN-US">T</span>he following query retrieves user content objects which have been tagged with the tag <span class="inlineformat--code">"social"</span>: </p><p class="p--codeblock">List&lt;UserContent&gt; userContentByTag = (List&lt;UserContent&gt;)  <br/>  baseModule.createQuery(baseModule.getUserContentType())<br/>   .where(baseModule.getUserContentCriteria()<br/>   .taggedWith("social"))<br/>   .list();</p><p>This query is yielding resource beans of type <span class="inlineformat--code">UserContent</span>. The result set is restricted by a criterion requiring the user content objects to be tagged with <span class="inlineformat--code">"social"</span>.  There might be quite many content objects tagged like this, so it is a good idea to restrict the number of results using the <span class="inlineformat--code" xml:lang="EN-US">Query.setLimit()</span><span xml:lang="EN-US">method. </span></p><p><span xml:lang="EN-US">Limiting the size of the result set generally makes sense only if we also impose an ordering on it. Otherwise it will be database implementation dependant which items are included in the result list, these may vary each time we execute the query. So we also order the result list by the creation date by using </span><span class="inlineformat--code" xml:lang="EN-US">Query.orderBy()</span><span xml:lang="EN-US">:</span></p><p class="p--codeblock">UserContentCriteria userContentCriteria = <br/>     baseModule.getUserContentCriteria();<br/>List&lt;UserContent&gt; userContentByTag = (List&lt;UserContent&gt;)  <br/>  baseModule.createQuery(baseModule.getUserContentType())<br/>   .where(userContentCriteria.taggedWith("social"))<br/>   .orderBy(userContentCriteria<br/>   .orderByCreationDate(Order.Direction.DESCENDING))<br/>   .setLimit(20)<br/>   .list();</p><p><span xml:lang="EN-US">Note that the order is </span>chosen<span xml:lang="EN-US"> to be descending so that we get the 20 newest user content objects which exist in the SSE repository.</span></p><p>Again, there are two layers of criteria factories. The core level criteria factories are the class <span class="inlineformat--code">ElementCriteria</span> and its two subclasses <span class="inlineformat--code">ResourceCriteria</span> and <span class="inlineformat--code">RelationshipCriteria</span>, all within the <span class="inlineformat--code">com.coremedia.sse.core.queries</span> package. These are the foundation on which the domain level criteria factories in the <span class="inlineformat--code">com.coremedia.sse.base.queries</span> package are build upon. The core level criteria factories should be used in conjunction with core level queries created from the repository, whereas the domain level factories should be used in conjunction with queries created from the base module (see above).</p><p class="align--none">The topmost criteria factory classes are <span class="inlineformat--code">ElementBeanCriteria</span> and its two subclasses <span class="inlineformat--code">ResourceBeanCriteria</span> and <span class="inlineformat--code">RelationshipBeanCriteria</span>. These carry the term "bean" within their names to emphasize the fact that they operate with <span class="inlineformat--coremediaCAE">CAE</span> beans rather than the core SSE element objects. In particular, they provide transparent conversions between beans external to the SSE repository (that is, all beans which are not derived from <span class="inlineformat--code">com.coremedia.sse.beans.ElementBean</span>) and their representational proxy within the SSE repository (instances of <span class="inlineformat--code">com.coremedia.base.model.ExternalReference</span>), using the <span class="inlineformat--code">IdProvider</span> and the <span class="inlineformat--code">ElementBeanFactory</span> configured for the base module. This comes in handy if you want to find all comments to some <span class="inlineformat--sctproduct">CAP</span> content objects, for example. The <span class="inlineformat--sctproduct">CAP</span> content objects are stored within the <span class="inlineformat--sctproduct">CAP</span> Content Repository, whereas the comments are stored within the SSE repository.</p><p>In contrast to the three core level criteria factory classes which are not subclassed any further, these three domain level criteria factories merely provide the generic foundation for more criteria factory classes which can be found in the same package. They add more factory methods which are specific for the corresponding domain model type. For example, factory methods for the resource type <span class="inlineformat--code">User</span> are bundled within the factory class <span class="inlineformat--code">UserCriteria</span>, and factory methods for the relationship type <span class="inlineformat--code">Voting</span> are bundled within the factory class <span class="inlineformat--code">VotingCriteria</span>.</p><p>This criteria factory class hierarchy is designed for extensibility. It is intended that you define your own criteria factory classes if you extend the base module domain model. This should be done by subclassing the factory class which corresponds to the base module domain model class that has been extended. This new criterion factory is then the place to define factory methods specific to your domain.</p><p>The predefined criteria factories found in the base module suffice as long as you do not extend the base module domain model by defining your own element types with their own properties. In that case, you won't be able to query for the new properties you defined. This is because the property criterion factory methods check whether a given property is defined within the element type of the factory.</p><p>However, subclassing criteria factories is not always necessary. Most of the time it will be sufficient to just create a domain type specific criterion factory instance by instantiating one of the existing factory classes, passing in the domain type to the constructor. This way, you may already use all the new properties defined within your domain type. Finally, if you do not define any new properties and also do not want to provide any factory methods which encapsulate some domain specific logic for programming convenience, you may always use the criterion factory provided with the base module. The criterion factory of the base module is  most specific to your new element type.</p></div>